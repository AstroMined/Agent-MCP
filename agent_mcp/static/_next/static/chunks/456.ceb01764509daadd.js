"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[456],{6456:(e,r,s)=>{s.r(r),s.d(r,{default:()=>v});var t=s(5155),a=s(2115),n=s(2368),i=s(7168),o=s(8145);let l=(0,s(9946).A)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);var d=s(2775),c=s(9397),u=s(3904),h=s(1886),m=s(8990),p=s(3999);let g={physics:{enabled:!0,barnesHut:{gravitationalConstant:-12e3,centralGravity:.05,springLength:250,springConstant:.02,damping:.2,avoidOverlap:1},maxVelocity:50,minVelocity:.1,solver:"barnesHut",stabilization:{enabled:!0,iterations:1e3,updateInterval:25,fit:!0},adaptiveTimestep:!0,timestep:.5},layout:{hierarchical:{enabled:!1}},nodes:{shape:"box",borderWidth:2,shadow:!0,font:{size:14,face:"Segoe UI, sans-serif",color:"#ffffff"},scaling:{label:{enabled:!0,min:8,max:20}}},edges:{width:2,shadow:!0,smooth:{enabled:!0,type:"continuous",forceDirection:"none",roundness:.5},font:{size:12,align:"middle",background:"rgba(40, 44, 52, 0.8)"},arrows:{to:{enabled:!0,scaleFactor:.8}}},groups:{agent:{shape:"ellipse",borderWidth:3,color:{background:"#4CAF50",border:"#2E7D32"}},task:{shape:"box",borderWidth:2,color:{background:"#FFC107",border:"#FFA000"}},context:{shape:"diamond",borderWidth:3,color:{background:"#9C27B0",border:"#7B1FA2"},shapeProperties:{borderDashes:!1},size:30},file:{shape:"triangle",borderWidth:2,color:{background:"#795548",border:"#5D4037"}},admin:{shape:"star",borderWidth:4,color:{background:"#e11d48",border:"#be123c"},font:{size:16,color:"#ffffff",bold:!0}}}},f={physics:{enabled:!0,hierarchicalRepulsion:{centralGravity:0,springLength:200,springConstant:.01,nodeDistance:250,damping:.09},solver:"hierarchicalRepulsion"},layout:{hierarchical:{enabled:!0,levelSeparation:300,nodeSpacing:250,treeSpacing:400,direction:"UD",sortMethod:"directed",shakeTowards:"roots",parentCentralization:!0,edgeMinimization:!0,blockShifting:!0}},nodes:g.nodes,edges:{...g.edges,smooth:{enabled:!0,type:"cubicBezier",forceDirection:"vertical",roundness:.5}},groups:g.groups},b=e=>{let r=25,s={},t="box";return"agent"===e.group?(r=35,t="ellipse",s="terminated"===e.status?{background:"#F44336",border:"#D32F2F"}:e.color?{background:e.color,border:"#2E7D32"}:{background:"#4CAF50",border:"#2E7D32"}):"task"===e.group?(r=30,t="box",s="completed"===e.status?{background:"#9E9E9E",border:"#757575"}:"cancelled"===e.status||"failed"===e.status?{background:"#FF9800",border:"#F57C00"}:"in_progress"===e.status?{background:"#2196F3",border:"#1976D2"}:{background:"#FFC107",border:"#FFA000"}):"context"===e.group?(r=25,t="diamond",s={background:"#9C27B0",border:"#7B1FA2"}):"file"===e.group?(r=25,t="triangle",s={background:"#795548",border:"#5D4037"}):"admin"===e.group&&(r=45,t="star",s={background:"#e11d48",border:"#be123c"}),{size:r,color:s,shape:t}},x=(e,r,s)=>{s>16.67&&console.warn("[VisGraph] Slow render detected: ".concat(s.toFixed(2),"ms for ").concat(r))};function v(e){let{fullscreen:r=!1,onNodeSelect:s}=e,v=(0,a.useRef)(null),w=(0,a.useRef)(null),y=(0,a.useRef)(new n.PG),k=(0,a.useRef)(new n.PG),{activeServerId:N,servers:j}=(0,m.m)(),C=j.find(e=>e.id===N),[F,S]=(0,a.useState)(!0),[E,A]=(0,a.useState)(null),[z,D]=(0,a.useState)("physics"),[M,_]=(0,a.useState)(!1),[I,P]=(0,a.useState)(0),[R,T]=(0,a.useState)(0),[W,G]=(0,a.useState)(!1);(0,a.useEffect)(()=>(G(!0),()=>{G(!1)}),[]);let O=(0,a.useCallback)(e=>{if(performance.mark("vis-data-conversion-start"),!e||!e.nodes||!e.edges)return void console.warn("Invalid graph data structure:",e);let r=new Set(y.current.getIds()),s=new Set(k.current.getIds()),t=new Set;e.edges.forEach(e=>{t.add(e.from),t.add(e.to)});let a=e.nodes.filter(e=>"hierarchical"===z?"task"===e.group||"file"===e.group:"admin"===e.group||"agent"!==e.group||t.has(e.id)),n=a.filter(e=>"context"===e.group),i=a.filter(e=>"task"===e.group),o=a.map(e=>{let r=b(e);if("admin"===e.group)return{...e,label:e.label||e.id,fixed:{x:!0,y:!0},x:0,y:0,physics:!1,...r,title:void 0};if("context"===e.group){let s=n.findIndex(r=>r.id===e.id)*(2*Math.PI/n.length);return{...e,label:e.label||e.id,x:400*Math.cos(s),y:400*Math.sin(s),fixed:{x:!0,y:!0},physics:!1,...r,title:void 0}}if("task"===e.group){let s=i.findIndex(r=>r.id===e.id),t=s*(2*Math.PI/i.length)+Math.PI/i.length,a=600+s%2*100;return{...e,label:e.label||e.id,x:Math.cos(t)*a,y:Math.sin(t)*a,...r,title:void 0}}return{...e,label:e.label||e.id,...r}}),l=e.edges.filter(e=>{if("hierarchical"===z){let r=a.find(r=>r.id===e.from),s=a.find(r=>r.id===e.to);return r&&s}return!0}).map((e,r)=>{let s={from:e.from,to:e.to,id:e.id||"edge-".concat(r),arrows:e.arrows||{to:{enabled:!0,scaleFactor:.5}}};return e.title&&(e.title.includes("Created by")?(s.color={color:"#555555",opacity:.2},s.width=.5,s.dashes=[2,4]):e.title.includes("Parent of")?(s.color={color:"#10b981"},s.width=3,s.smooth={enabled:!0,type:"curvedCW",roundness:.2}):e.title.includes("Depends on")?(s.color={color:"#f59e0b"},s.width=2,s.dashes=!0,s.smooth={enabled:!0,type:"curvedCCW",roundness:.2}):e.title.includes("Working on")&&(s.color={color:"#3b82f6"},s.width=3,s.smooth={enabled:!0,type:"continuous"})),(e.from.includes("context")||e.to.includes("context"))&&(s.color={color:"#9333ea",opacity:.3},s.width=1,s.dashes=[3,6],s.smooth={enabled:!0,type:"continuous",roundness:.8},s.arrows={to:{enabled:!0,scaleFactor:.3}}),e.color&&(s.color=e.color),e.width&&(s.width=e.width),s}),d=new Set(o.map(e=>e.id)),c=new Set(l.map(e=>e.id)),u=Array.from(r).filter(e=>!d.has(e)),h=[],m=[];o.forEach(e=>{r.has(e.id)?JSON.stringify(y.current.get(e.id))!==JSON.stringify(e)&&h.push(e):m.push(e)});let p=Array.from(s).filter(e=>!c.has(e)),g=[],f=[];l.forEach(e=>{s.has(e.id)?JSON.stringify(k.current.get(e.id))!==JSON.stringify(e)&&g.push(e):f.push(e)}),u.length>0&&y.current.remove(u),h.length>0&&y.current.update(h),m.length>0&&y.current.add(m),p.length>0&&k.current.remove(p),g.length>0&&k.current.update(g),f.length>0&&k.current.add(f),P(o.length),T(l.length),(0===r.size||m.length>5)&&setTimeout(()=>{w.current&&w.current.fit({animation:!0})},100),performance.mark("vis-data-conversion-end"),performance.measure("vis-data-conversion","vis-data-conversion-start","vis-data-conversion-end")},[z]),B=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!N||!C||"connected"!==C.status){A("No active server connection"),S(!1);return}try{(e||0===I)&&S(!0),A(null);let r=await h.uE.getGraphData();if(!r)throw Error("No data received from server");O(r)}catch(e){A(e instanceof Error?e.message:"Failed to fetch graph data"),console.error("Error fetching graph data:",e)}finally{S(!1)}},[N,C,O,I]);(0,a.useEffect)(()=>{if(!W)return;let e=setTimeout(()=>{if(!v.current)return;let{offsetWidth:e,offsetHeight:r}=v.current;if(0===e||0===r)return;let t="physics"===z?g:f,a={nodes:y.current,edges:k.current},i=new n.lg(v.current,a,t);w.current=i,i.on("click",e=>{if(e.nodes.length>0&&s){let r=e.nodes[0],t=y.current.get(r);t&&("admin"===t.group?s("admin","admin",t):("agent"===t.group||"task"===t.group||"context"===t.group||"file"===t.group)&&s(r,t.group,t))}}),i.on("hoverNode",()=>{v.current.style.cursor="pointer"}),i.on("blurNode",()=>{v.current.style.cursor="default"}),"physics"===z&&i.startSimulation();let o=new ResizeObserver(e=>{for(let r of e)r.target===v.current&&w.current&&(w.current.redraw(),setTimeout(()=>{var e;null==(e=w.current)||e.fit({animation:!1})},100))});v.current&&o.observe(v.current),window.__visCleanup=()=>{o.disconnect(),w.current&&(w.current.destroy(),w.current=null)}},100);return()=>{clearTimeout(e),window.__visCleanup&&(window.__visCleanup(),delete window.__visCleanup)}},[z,W,s]),(0,a.useEffect)(()=>{if(B(!0),M){let e=setInterval(()=>B(!1),3e4);return()=>clearInterval(e)}},[B,M]);let L=(0,a.useCallback)(e=>{if(D(e),w.current){let r="physics"===e?g:f;w.current.setOptions(r),"physics"===e&&w.current.startSimulation(),setTimeout(()=>{var e;null==(e=w.current)||e.fit({animation:!0})},100)}},[]);return(0,t.jsx)(a.Profiler,{id:"VisGraph",onRender:x,children:(0,t.jsx)("div",{className:(0,p.cn)("w-full h-full flex",r?"":"graph-container rounded-lg border"),children:(0,t.jsxs)("div",{className:"relative flex-1 min-w-0 bg-muted/20",children:[(0,t.jsxs)("div",{className:"absolute top-[var(--space-fluid-sm)] left-[var(--space-fluid-sm)] right-[var(--space-fluid-sm)] z-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-[var(--space-fluid-xs)]",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)("div",{className:"bg-background/95 backdrop-blur rounded-lg border p-0.5 sm:p-1 flex gap-0.5 sm:gap-1",children:[(0,t.jsxs)(i.$,{variant:"physics"===z?"default":"ghost",size:"sm",onClick:()=>L("physics"),className:"h-7 sm:h-8 px-2 sm:px-3 text-xs sm:text-sm",children:[(0,t.jsx)(l,{className:"h-3 sm:h-4 w-3 sm:w-4 mr-0.5 sm:mr-1"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Physics"}),(0,t.jsx)("span",{className:"sm:hidden",children:"P"})]}),(0,t.jsxs)(i.$,{variant:"hierarchical"===z?"default":"ghost",size:"sm",onClick:()=>L("hierarchical"),className:"h-7 sm:h-8 px-2 sm:px-3 text-xs sm:text-sm",children:[(0,t.jsx)(d.A,{className:"h-3 sm:h-4 w-3 sm:w-4 mr-0.5 sm:mr-1"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Tree"}),(0,t.jsx)("span",{className:"sm:hidden",children:"T"})]})]}),(0,t.jsxs)(o.E,{variant:"outline",className:"bg-background/95 backdrop-blur text-xs sm:text-sm",children:[(0,t.jsxs)("span",{className:"hidden sm:inline",children:[I," nodes, ",R," edges"]}),(0,t.jsxs)("span",{className:"sm:hidden",children:[I,"n, ",R,"e"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,t.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>_(!M),className:(0,p.cn)("bg-background/95 backdrop-blur h-7 sm:h-8 px-2 sm:px-3 text-xs sm:text-sm",M&&"bg-primary/10"),children:M?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.A,{className:"h-3 sm:h-4 w-3 sm:w-4 mr-0.5 sm:mr-1 animate-pulse"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Live"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.A,{className:"h-3 sm:h-4 w-3 sm:w-4 mr-0.5 sm:mr-1"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Manual"})]})}),(0,t.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>B(!0),disabled:F,className:"bg-background/95 backdrop-blur h-7 sm:h-8 px-2 sm:px-3",children:F?(0,t.jsx)(u.A,{className:"h-3 sm:h-4 w-3 sm:w-4 animate-spin"}):(0,t.jsx)(u.A,{className:"h-3 sm:h-4 w-3 sm:w-4"})})]})]}),F&&0===I?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)(u.A,{className:"h-12 w-12 mx-auto animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading graph data..."})]})}):E&&0===I?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)(c.A,{className:"h-12 w-12 mx-auto text-destructive"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:E}),(0,t.jsx)(i.$,{onClick:()=>B(!0),variant:"outline",children:"Retry"})]})}):(0,t.jsx)("div",{ref:v,className:"w-full h-full"})]})})})}}}]);